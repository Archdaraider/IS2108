{% extends "adminpanel/base.html" %}
{% load static %}

{% block title %}Edit: {{ customer.name }}{% endblock %}

{% block content %}

<form method="post" novalidate>
    {% csrf_token %}
    
    <div class="content-panel">
        <div class="content-panel-header">
            <h2>{{ customer.name }} ({{ customer.cID }})</h2>
            <div class="form-actions-header">
                <a href="{% url 'customer_list' %}" class="btn-secondary">Back to List</a>
                <button type="submit" class="btn-primary">Save Changes</button>
            </div>
        </div>
    </div>

    {% if form.errors %}
        <div class="content-panel error-panel">
            <p><strong>Please correct the errors below:</strong></p>
            {{ form.non_field_errors }}
            {% for field in form %}
                {% if field.errors %}
                    <p><strong>{{ field.label }}:</strong> {{ field.errors|striptags }}</p>
                {% endif %}
            {% endfor %}
        </div>
    {% endif %}

    <!-- Main form panel -->
    <div class="content-panel">
        <div class="content-panel-header">
            <h3>Customer Details</h3>
        </div>
        <div class="content-panel-body">
            <!-- This grid layout will automatically arrange the fields -->
            <div class="form-container">
                {{ form.as_p }}
            </div>
        </div>
    </div>
</form>

<!-- Delete Button (at the bottom) -->
<div class="content-panel delete-zone">
    <div class="delete-zone-content">
        <h4>Delete Customer</h4>
        <p>This action is permanent and cannot be undone. This will remove the customer and may affect associated orders.</p>
        
        <form id="delete-form" action="{% url 'customer_delete' customer.pk %}" method="post">
            {% csrf_token %}
            <button type="button" id="delete-btn-confirm" class="btn-danger">Delete This Customer</button>
        </form>
    </div>
</div>

<script>
    // Simple confirmation pop-up before deleting
    document.getElementById('delete-btn-confirm').addEventListener('click', function(e) {
        if (!confirm('Are you sure you want to permanently delete this customer?')) {
            e.preventDefault();
        } else {
            document.getElementById('delete-form').submit();
        }
    });
</script>

{% endblock content %}
