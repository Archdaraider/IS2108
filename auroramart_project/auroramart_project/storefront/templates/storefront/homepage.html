<!-- homepage.html -->
{% extends 'storefront/base.html' %}
{% load static %}

{% block title %}AuroraMart - Your Online Shopping Destination{% endblock %}

{% block content %}
<!-- Hero Banner Carousel -->
<section class="hero-section">
    <div class="hero-carousel">
        {% for banner in banners %}
        <div class="hero-slide">
            <div class="hero-image">
                {% if banner.image %}
                    <img src="{{ banner.image.url }}" alt="{{ banner.title }}">
                {% else %}
                    <div class="hero-placeholder">
                        <i class="fas fa-image"></i>
                    </div>
                {% endif %}
            </div>
            <div class="hero-content">
                <h1>{{ banner.title }}</h1>
                {% if banner.subtitle %}
                    <p>{{ banner.subtitle }}</p>
                {% endif %}
                {% if banner.link_url %}
                    <a href="{{ banner.link_url }}" class="btn btn-primary">Shop Now</a>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <div class="hero-slide">
            <div class="hero-placeholder">
                <i class="fas fa-shopping-bag"></i>
                <h1>Welcome to AuroraMart</h1>
                <p>Discover amazing products at great prices</p>
                <a href="{% url 'product_list' %}" class="btn btn-primary">Start Shopping</a>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Carousel Controls -->
    <button class="carousel-btn carousel-prev">
        <i class="fas fa-chevron-left"></i>
    </button>
    <button class="carousel-btn carousel-next">
        <i class="fas fa-chevron-right"></i>
    </button>
    
    <!-- Carousel Dots -->
    <div class="carousel-dots">
        {% for banner in banners %}
        <span class="dot"></span>
        {% endfor %}
    </div>
</section>

<!-- Recommended For You Section -->
<section class="product-section">
    <div class="container">
        <div class="section-header">
            <h2>Recommended For You</h2>
            <a href="{% url 'product_list' %}" class="section-link">View All <i class="fas fa-arrow-right"></i></a>
        </div>
        
        <div class="product-grid">
            {% for product in featured_products %}
            <div class="product-card">
                <div class="product-image">
                    {% if product.image %}
                        <img src="{{ product.image.url }}" alt="{{ product.name }}">
                    {% else %}
                        <div class="product-placeholder">
                            <i class="fas fa-image"></i>
                        </div>
                    {% endif %}
                    <div class="product-actions">
                        <button class="action-btn wishlist-btn" data-product-id="{{ product.id }}">
                            <i class="fas fa-heart"></i>
                        </button>
                        <button class="action-btn quick-view-btn" data-product-id="{{ product.id }}">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="product-info">
                    <div class="product-price">${{ product.price|floatformat:2 }}</div>
                    <h3 class="product-name">{{ product.name }}</h3>
                    <div class="product-category">{{ product.category }}</div>
                    <div class="product-rating">
                        <div class="stars">
                            {% for i in "12345" %}
                                {% if forloop.counter <= product.rating %}
                                    <i class="fas fa-star"></i>
                                {% else %}
                                    <i class="far fa-star"></i>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <span class="rating-text">{{ product.rating }} (2.8k)</span>
                    </div>
                    <button class="btn btn-primary add-to-cart-btn" data-product-id="{{ product.id }}">
                        Add to cart
                    </button>
                </div>
            </div>
            {% empty %}
            <div class="no-products">
                <i class="fas fa-box-open"></i>
                <p>No products available at the moment.</p>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Best Sellers Section -->
<section class="product-section">
    <div class="container">
        <div class="section-header">
            <h2>AuroraMart's best sellers</h2>
            <a href="{% url 'product_list' %}?sort=rating" class="section-link">View All <i class="fas fa-arrow-right"></i></a>
        </div>
        
        <div class="product-grid">
            {% for product in best_sellers %}
            <div class="product-card">
                <div class="product-image">
                    {% if product.image %}
                        <img src="{{ product.image.url }}" alt="{{ product.name }}">
                    {% else %}
                        <div class="product-placeholder">
                            <i class="fas fa-image"></i>
                        </div>
                    {% endif %}
                    <div class="product-actions">
                        <button class="action-btn wishlist-btn" data-product-id="{{ product.id }}">
                            <i class="fas fa-heart"></i>
                        </button>
                        <button class="action-btn quick-view-btn" data-product-id="{{ product.id }}">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="product-info">
                    <div class="product-price">${{ product.price|floatformat:2 }}</div>
                    <h3 class="product-name">{{ product.name }}</h3>
                    <div class="product-category">{{ product.category }}</div>
                    <div class="product-rating">
                        <div class="stars">
                            {% for i in "12345" %}
                                {% if forloop.counter <= product.rating %}
                                    <i class="fas fa-star"></i>
                                {% else %}
                                    <i class="far fa-star"></i>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <span class="rating-text">{{ product.rating }} (2.8k)</span>
                    </div>
                    <button class="btn btn-primary add-to-cart-btn" data-product-id="{{ product.id }}">
                        Add to cart
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Customer Reviews Section -->
<section class="reviews-section">
    <div class="container">
        <div class="reviews-placeholder">
            <h2>Reviews from other customers?</h2>
            <p>Share your experience and help others make informed decisions</p>
            <a href="#" class="btn btn-secondary">Write a Review</a>
        </div>
    </div>
</section>

<!-- Newsletter Subscription -->
<section class="newsletter-section">
    <div class="container">
        <div class="newsletter-content">
            <h2>Stay Updated</h2>
            <p>Subscribe to our newsletter for the latest deals and updates</p>
            <form class="newsletter-form" id="newsletter-form">
                <input type="email" placeholder="Enter your email" class="newsletter-input" required>
                <button type="submit" class="btn btn-primary">Subscribe</button>
            </form>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
// Carousel functionality
document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.querySelector('.hero-carousel');
    const slides = document.querySelectorAll('.hero-slide');
    const dots = document.querySelectorAll('.dot');
    const prevBtn = document.querySelector('.carousel-prev');
    const nextBtn = document.querySelector('.carousel-next');
    
    let currentSlide = 0;
    
    function showSlide(index) {
        slides.forEach((slide, i) => {
            slide.style.display = i === index ? 'block' : 'none';
        });
        dots.forEach((dot, i) => {
            dot.classList.toggle('active', i === index);
        });
    }
    
    function nextSlide() {
        currentSlide = (currentSlide + 1) % slides.length;
        showSlide(currentSlide);
    }
    
    function prevSlide() {
        currentSlide = (currentSlide - 1 + slides.length) % slides.length;
        showSlide(currentSlide);
    }
    
    // Event listeners
    nextBtn.addEventListener('click', nextSlide);
    prevBtn.addEventListener('click', prevSlide);
    
    // Auto-advance carousel
    setInterval(nextSlide, 5000);
    
    // Initialize
    showSlide(0);
});

// Newsletter subscription
document.getElementById('newsletter-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const email = this.querySelector('.newsletter-input').value;
    
    fetch('{% url "subscribe_newsletter" %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({email: email})
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            this.reset();
        } else {
            alert(data.message);
        }
    });
});
</script>
{% endblock %}
